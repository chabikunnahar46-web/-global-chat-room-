<!DOCTYPE html>
<html>
<head>
  <title>Login / Signup</title>
  <style>
    body{font-family:Arial;background:#f5f5f5;padding:40px;}
    .box{
      width:300px;margin:auto;background:white;padding:20px;
      border-radius:10px;box-shadow:0 0 10px #ccc;
    }
    input{
      width:100%;padding:10px;margin:10px 0;border:1px solid #ddd;
      border-radius:5px;
    }
    button{
      width:100%;padding:10px;background:#0084ff;color:white;
      border:none;border-radius:5px;font-size:16px;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>Create Account / Login</h2>
    <input id="email" placeholder="Email">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login / Signup</button>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { createUserWithEmailAndPassword, signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { doc, setDoc } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    async function login(){
      let email = email.value;
      let pass = pass.value;

      try {
        let user = await signInWithEmailAndPassword(auth, email, pass);
        location.href = "profile.html";
      } catch {
        let user = await createUserWithEmailAndPassword(auth, email, pass);

        // create default profile
        await setDoc(doc(db, "users", user.user.uid), {
          email: email,
          name: "New User",
          photo: "https://i.ibb.co/4pDNDk1/avatar.png"
        });

        location.href = "profile.html";
      }
    }
  </script>
</body>
</html>
