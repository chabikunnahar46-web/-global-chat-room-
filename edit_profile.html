<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Profile</title>
<link rel="stylesheet" href="profile.css">
</head>
<body>
<h2>Edit Your Profile</h2>

<div class="edit-form">
    <label>Name:</label>
    <input type="text" id="nameInput"><br>

    <label>Surname:</label>
    <input type="text" id="surnameInput"><br>

    <label>DOB:</label>
    <input type="date" id="dobInput"><br>

    <label>Work / Profession:</label>
    <input type="text" id="workInput"><br>

    <label>School:</label>
    <input type="text" id="schoolInput"><br>

    <label>Profile Picture:</label>
    <input type="file" id="profileUpload"><br>

    <label>Cover Photo:</label>
    <input type="file" id="coverUpload"><br>

    <button id="saveBtn">Save Profile</button>
</div>

<script type="module">
import { database } from './firebase.js';
import { ref, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

// ইউজার আইডি ধরো (login বা localStorage থেকে)
const userId = localStorage.getItem("userId") || "guest";
const userRef = ref(database, "profiles/" + userId);

// Cloudinary আপলোড ফাংশন
async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "YOUR_CLOUDINARY_PRESET"); // Cloudinary preset

    const res = await fetch("https://api.cloudinary.com/v1_1/YOUR_CLOUD_NAME/image/upload", {
        method: "POST",
        body: formData
    });
    const data = await res.json();
    return data.secure_url;
}

// Save Button
document.getElementById("saveBtn").addEventListener("click", async () => {
    const name = document.getElementById("nameInput").value;
    const surname = document.getElementById("surnameInput").value;
    const dob = document.getElementById("dobInput").value;
    const work = document.getElementById("workInput").value;
    const school = document.getElementById("schoolInput").value;

    let profileURL = "";
    let coverURL = "";

    const profileFile = document.getElementById("profileUpload").files[0];
    const coverFile = document.getElementById("coverUpload").files[0];

    if(profileFile){
        profileURL = await uploadToCloudinary(profileFile);
    }

    if(coverFile){
        coverURL = await uploadToCloudinary(coverFile);
    }

    set(userRef, {
        name: name,
        surname: surname,
        dob: dob,
        work: work,
        school: school,
        profile: profileURL || "",
        cover: coverURL || ""
    }).then(() => {
        alert("Profile saved successfully!");
    }).catch(err => {
        console.error(err);
        alert("Error saving profile!");
    });
});
</script>
</body>
      </html>
